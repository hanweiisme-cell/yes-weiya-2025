<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éˆºç¥¥ä¼æ¥­ 2025 å°¾ç‰™å…¨æ–¹ä½ç³»çµ± (æ™ºæ…§åµæ¸¬ç‰ˆ)</title>
    <style>
        /* === å…±ç”¨åŸºç¤æ¨£å¼ === */
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #1A237E, #0D47A1, #01579B);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* æ­¡è¿é é¢ */
        #welcomeScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(13, 71, 161, 0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; cursor: pointer; transition: opacity 0.5s;
        }
        #welcomeScreen h1 { font-size: 3rem; margin-bottom: 20px; text-shadow: 0 0 10px #42A5F5; }
        #welcomeScreen p { font-size: 1.5rem; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* Logo */
        .logo-container { margin-bottom: 10px; text-align: center; min-height: 100px; display: flex; align-items: center; justify-content: center;}
        .logo { max-width: 350px; height: auto; filter: drop-shadow(0px 4px 6px rgba(0,0,0,0.3)); }
        .logo-fallback { font-size: 2.5rem; font-weight: 900; color: #fff; text-shadow: 0 0 10px #4FC3F7; letter-spacing: 3px; }

        /* åˆ†é å°è¦½åˆ— */
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; z-index: 10; }
        .nav-btn {
            padding: 12px 30px; font-size: 1.2rem; font-weight: bold; border: none; border-radius: 30px;
            cursor: pointer; transition: all 0.3s; background: rgba(255,255,255,0.2); color: #ccc;
            border: 2px solid transparent;
        }
        .nav-btn.active { background: #FFD700; color: #b71c1c; box-shadow: 0 0 15px #FFD700; transform: scale(1.1); }
        .nav-btn:hover:not(.active) { background: rgba(255,255,255,0.4); color: white; }

        /* ä¸»å®¹å™¨ */
        .main-container {
            position: relative;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px; border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            max-width: 1000px; width: 95%;
            min-height: 600px;
        }

        .view-section { display: none; animation: fadeIn 0.5s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* æŠ½çæ¨£å¼ */
        .raffle-layout { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .display-area-raffle {
            width: 100%; min-height: 180px; background: #0D47A1; color: #E3F2FD;
            display: flex; align-items: center; justify-content: center;
            font-size: 3.5rem; font-weight: bold; border-radius: 10px; margin: 10px 0;
            border: 8px solid #42A5F5; text-align: center;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
            text-shadow: 0 0 15px rgba(66, 165, 245, 0.8);
            padding: 20px; line-height: 1.3; word-break: break-all;
        }
        .current-prize { font-size: 1.8rem; color: #1565C0; font-weight: bold; border-bottom: 2px solid #E3F2FD; padding-bottom: 10px; width: 100%; text-align: center; }
        .result-list { width: 100%; max-height: 250px; overflow-y: auto; border-top: 2px solid #eee; padding-top: 10px; margin-top: 20px;}
        .result-header-group { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 2px solid #1565C0; padding-bottom: 5px; }
        .result-item { background: #fff; padding: 10px 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; font-size: 1.1rem; }
        .result-item:nth-child(even) { background-color: #E3F2FD; }

        /* éŠæˆ²æ¨£å¼ */
        .game-layout { text-align: center; padding: 20px; }
        .range-display {
            font-size: 7rem; font-weight: 900; margin: 20px 0; color: #1565C0;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1); letter-spacing: 5px;
        }
        .game-input-area { margin-top: 20px; display: flex; justify-content: center; gap: 10px; }
        .game-input { font-size: 2rem; padding: 10px; width: 150px; text-align: center; border: 4px solid #FFEB3B; border-radius: 10px; outline: none; }
        .game-status-text { height: 30px; color: #d32f2f; font-size: 1.2rem; margin-top: 10px; font-weight: bold;}
        .winner-overlay {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 50; border-radius: 20px;
            flex-direction: column; justify-content: center; align-items: center; color: white;
        }
        .winner-overlay h2 { font-size: 4rem; color: #FFEB3B; margin: 0; text-shadow: 0 0 20px red; }

        /* å…ƒä»¶ */
        .big-btn {
            padding: 10px 40px; font-size: 1.8rem; cursor: pointer; background: #1565C0;
            color: white; border: none; border-radius: 50px; transition: all 0.3s;
            box-shadow: 0 6px 10px rgba(21, 101, 192, 0.3); font-weight: bold;
        }
        .big-btn:hover { background: #0D47A1; transform: scale(1.05); }
        .big-btn.rolling { background: #42A5F5; animation: pulse 0.5s infinite alternate; box-shadow: 0 0 25px #42A5F5; }
        
        .admin-panel { display: none; width: 100%; border-top: 2px dashed #ccc; margin-top: 20px; padding-top: 20px; gap: 20px; flex-wrap: wrap; }
        .panel-col { flex: 1; min-width: 250px; display: flex; flex-direction: column; }
        textarea { width: 95%; height: 150px; padding: 10px; border: 2px solid #90CAF9; border-radius: 8px; }
        
        .toggle-btn { position: fixed; bottom: 20px; right: 20px; background: rgba(255,255,255,0.8); padding: 10px 15px; border-radius: 20px; cursor: pointer; border: 1px solid #ccc; font-weight: bold;}
        .music-toggle { margin-top: 10px; color: #1565C0; cursor: pointer; text-decoration: underline; font-size: 0.9rem;}

        .cloud-status { margin-top: 15px; font-size: 1rem; color: #666; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold; }
        .dot { width: 12px; height: 12px; background: #ccc; border-radius: 50%; }
        .dot.active { background: #00E676; box-shadow: 0 0 8px #00E676; animation: blinkStatus 1s infinite alternate; }
        @keyframes blinkStatus { from { opacity: 0.6; } to { opacity: 1; } }
        
        /* åµéŒ¯ç›£æ§å€ */
        .debug-console {
            width: 100%; background: #000; color: #00E676; font-family: monospace; 
            padding: 10px; font-size: 0.8rem; height: 80px; overflow-y: auto;
            border-radius: 5px; margin-top: 10px; display: none;
        }

    </style>
</head>
<body>

    <div id="welcomeScreen" onclick="enterSystem()">
        <h1>éˆºç¥¥ä¼æ¥­ 2025 å°¾ç‰™ç³»çµ±</h1>
        <p>ğŸµ é»æ“Šç•«é¢è¼‰å…¥éŸ³æ•ˆ ğŸµ</p>
    </div>

    <div class="logo-container">
        <img src="logo.png" alt="éˆºç¥¥ä¼æ¥­" class="logo" onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=\'logo-fallback\'>éˆºç¥¥ä¼æ¥­è‚¡ä»½æœ‰é™å…¬å¸</div>';">
    </div>

    <div class="nav-tabs">
        <button class="nav-btn active" onclick="switchTab('raffle')">ğŸ’° å¹¸é‹æŠ½ç</button>
        <button class="nav-btn" onclick="switchTab('game')">ğŸ’£ çµ‚æ¥µå¯†ç¢¼</button>
    </div>

    <audio id="raffleBg" loop src="bg.mp3"></audio>
    <audio id="rollSound" loop src="roll.mp3"></audio>
    <audio id="winSound" src="win.mp3"></audio>
    <audio id="gameBg" loop src="game_bg.mp3"></audio>
    <audio id="beepSound" src="beep.mp3"></audio>
    <audio id="boomSound" src="boom.mp3"></audio>

    <div class="main-container">
        
        <div id="raffleView" class="view-section active">
            <div class="raffle-layout">
                <div class="current-prize" id="currentPrizeDisplay">æº–å‚™æŠ½ç</div>
                <div class="display-area-raffle" id="display">READY</div>
                <div style="display:flex; align-items:center; gap:10px; background:#E3F2FD; padding:5px 20px; border-radius:20px;">
                    <label>ä¸€æ¬¡æŠ½</label>
                    <input type="number" id="drawCount" value="1" min="1" max="100" style="width:50px; text-align:center; font-size:1.2rem; border:2px solid #1565C0; border-radius:5px;">
                    <label>äºº</label>
                </div>
                <button id="drawBtn" class="big-btn" onclick="startDraw()">é–‹å§‹æŠ½ç</button>
                <div class="music-toggle" onclick="toggleRaffleMusic()">ğŸ”Š èƒŒæ™¯éŸ³æ¨‚é–‹/é—œ</div>
                <div class="result-list" id="resultList">
                    <div class="result-header-group">
                        <h3 style="margin:0; color:#1565C0;">ğŸ† ä¸­çåå–®</h3>
                        <div>
                            <button onclick="copyToClipboard()" style="cursor:pointer;">ğŸ“‹ è¤‡è£½</button>
                            <button onclick="exportToExcel()" style="cursor:pointer;">ğŸ“¥ åŒ¯å‡º</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="gameView" class="view-section">
            <div class="game-layout">
                <div style="color:#888; font-size:1.2rem;">ç›®å‰ç¯„åœ</div>
                <div class="range-display" id="rangeDisplay">1 ~ 100</div>
                <div class="game-status-text" id="gameMessage"></div>
                <div class="cloud-status">
                    <span class="dot" id="syncDot"></span>
                    <span id="syncText">ğŸ”´ é›²ç«¯è‡ªå‹•æ¨¡å¼ï¼šæœªé€£ç·š</span>
                </div>
                <div class="game-input-area" style="opacity:0.6; transform:scale(0.9);">
                    <input type="number" id="gameInput" class="game-input" placeholder="æ‰‹å‹•å‚™ç”¨" onkeydown="if(event.key==='Enter') makeGuess()">
                    <button class="big-btn" style="padding:10px 20px; font-size:1.2rem; background:#777;" onclick="makeGuess()">æ‰‹å‹•é€å‡º</button>
                </div>
                <div class="music-toggle" onclick="toggleGameMusic()">ğŸ”Š éŠæˆ²éŸ³æ¨‚é–‹/é—œ</div>
                <div id="winnerOverlay" class="winner-overlay" onclick="closeOverlay()">
                    <h1 style="font-size:3rem; margin-bottom:10px;">ğŸ‰ å¯†ç¢¼çˆ†ç‚¸ï¼</h1>
                    <h2 id="boomNumber">50</h2>
                    <p style="margin-top:20px; color:#ccc;">(é»æ“Šé—œé–‰)</p>
                </div>
            </div>
        </div>

        <div class="admin-panel" id="adminPanel">
            <div class="panel-col">
                <h4 style="color:#1565C0; margin:0 0 5px 0;">[æŠ½ç] åå–®</h4>
                <textarea id="nameList">ç‹å°æ˜
æå¤§è¯
éˆºç¥¥å“¡å·¥...</textarea>
                <div style="text-align:right;">äººæ•¸: <span id="count">3</span></div>
            </div>
            <div class="panel-col">
                <h4 style="color:#1565C0; margin:0 0 5px 0;">[æŠ½ç] çé …</h4>
                <textarea id="prizeList">çé …1
çé …2</textarea>
            </div>
            <div class="panel-col" style="border-left:2px dashed #ccc; padding-left:20px;">
                <h4 style="color:#d32f2f; margin:0 0 5px 0;">[éŠæˆ²] è¨­å®š</h4>
                <label>ç¯„åœï¼š</label>
                <input type="number" id="minSet" value="1" style="width:50px;"> ~ 
                <input type="number" id="maxSet" value="100" style="width:50px;">
                <br><br>
                <label>ğŸ”¥ æŒ‡å®šå¯†ç¢¼ (å¿…å¡«)ï¼š</label>
                <input type="number" id="secretSet" placeholder="88" style="width:60px; font-weight:bold; color:red; font-size:1.2rem; text-align:center;">
                <br><br>
                <label>â˜ï¸ Google CSV ç¶²å€ï¼š</label>
                <input type="text" id="sheetUrl" placeholder="https://docs.google.com/..." style="width:95%; padding:5px;" onchange="updateSheetUrl()">
                <br>
                <div class="debug-console" id="debugConsole">ç›£æ§ç´€éŒ„å°‡é¡¯ç¤ºæ–¼æ­¤...</div>
                <button onclick="resetGame()" style="background:#d32f2f; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; width:100%; margin-top:10px;">é‡ç½®éŠæˆ² / å¥—ç”¨è¨­å®š</button>
            </div>
        </div>
    </div>

    <button class="toggle-btn" onclick="toggleAdmin()">âš™ï¸ å¾Œå°è¨­å®š</button>

    <script>
        // === ç³»çµ±åŸºç¤ ===
        let currentTab = 'raffle';
        const adminPanel = document.getElementById('adminPanel');
        const debugConsole = document.getElementById('debugConsole');

        const raffleBg = document.getElementById('raffleBg');
        const rollSound = document.getElementById('rollSound');
        const winSound = document.getElementById('winSound');
        const gameBg = document.getElementById('gameBg');
        const beepSound = document.getElementById('beepSound');
        const boomSound = document.getElementById('boomSound');

        raffleBg.volume = 0.3; gameBg.volume = 0.4;
        rollSound.volume = 0.6; winSound.volume = 1.0;
        beepSound.volume = 0.8; boomSound.volume = 1.0;

        function enterSystem() {
            document.getElementById('welcomeScreen').style.opacity = '0';
            setTimeout(() => { document.getElementById('welcomeScreen').style.display = 'none'; }, 500);
            raffleBg.play().then(() => { if(currentTab !== 'raffle') raffleBg.pause(); }).catch(()=>{});
            gameBg.play().then(() => { if(currentTab !== 'game') gameBg.pause(); }).catch(()=>{});
            playCurrentBg();
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(tab + 'View').classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            stopAllBg();
            playCurrentBg();
        }

        function playCurrentBg() {
            if (currentTab === 'raffle') { raffleBg.currentTime=0; raffleBg.play().catch(()=>{}); }
            else { gameBg.currentTime=0; gameBg.play().catch(()=>{}); }
        }
        function stopAllBg() { raffleBg.pause(); gameBg.pause(); }
        
        function toggleAdmin() {
            if (adminPanel.style.display === 'flex') {
                adminPanel.style.display = 'none';
            } else {
                adminPanel.style.display = 'flex';
                debugConsole.style.display = 'block'; // æ‰“é–‹ç›£æ§
                adminPanel.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function logDebug(msg) {
            const time = new Date().toLocaleTimeString();
            debugConsole.innerHTML = `[${time}] ${msg}<br>` + debugConsole.innerHTML;
        }

        // === [A] æŠ½çé‚è¼¯ (ç²¾ç°¡ç‰ˆ) ===
        let names=[], prizes=[], isRaffleRolling=false, raffleTimer, historyData=[];
        const nameInput = document.getElementById('nameList');
        const prizeInput = document.getElementById('prizeList');
        const raffleDisplay = document.getElementById('display');
        const countSpan = document.getElementById('count');
        const prizeDisplay = document.getElementById('currentPrizeDisplay');
        const drawBtn = document.getElementById('drawBtn');
        const resultList = document.getElementById('resultList');

        updateRaffleData();
        nameInput.addEventListener('input', updateRaffleData);
        prizeInput.addEventListener('input', updateRaffleData);

        function updateRaffleData() {
            names = nameInput.value.split('\n').filter(n=>n.trim()!=='');
            prizes = prizeInput.value.split('\n').filter(p=>p.trim()!=='');
            countSpan.textContent = names.length;
            if (!isRaffleRolling) prizeDisplay.textContent = prizes.length>0 ? "æº–å‚™æŠ½å‡ºï¼š"+prizes[0] : "çé …å·²å…¨æ•¸æŠ½å‡ºï¼";
        }

        function toggleRaffleMusic() { if(raffleBg.paused) raffleBg.play(); else raffleBg.pause(); }

        function startDraw() {
            updateRaffleData();
            const drawCount = parseInt(document.getElementById('drawCount').value)||1;
            if(isRaffleRolling) {
                clearInterval(raffleTimer); isRaffleRolling=false;
                drawBtn.textContent="é–‹å§‹æŠ½ç"; drawBtn.classList.remove('rolling');
                rollSound.pause(); rollSound.currentTime=0;
                let winners=[];
                for(let i=0; i<drawCount; i++){
                    if(names.length===0) break;
                    let idx = Math.floor(Math.random()*names.length);
                    winners.push(names[idx]); names.splice(idx,1);
                }
                raffleDisplay.textContent = winners.join('ã€');
                winSound.currentTime=0; winSound.play();
                addHistory(prizes[0], winners.join('ã€'));
                nameInput.value = names.join('\n');
                prizes.shift(); prizeInput.value=prizes.join('\n');
                updateRaffleData();
            } else {
                if(names.length===0) return alert("åå–®ç©ºäº†");
                if(prizes.length===0) return alert("æ²’çå“äº†");
                isRaffleRolling=true;
                drawBtn.textContent="åœæ­¢ï¼"; drawBtn.classList.add('rolling');
                prizeDisplay.textContent=`ğŸ”¥ æ­£åœ¨æŠ½å‡º ${drawCount} ä½ï¼š${prizes[0]}`;
                rollSound.currentTime=0; rollSound.play();
                raffleTimer=setInterval(()=>{ raffleDisplay.textContent=names[Math.floor(Math.random()*names.length)]; },40);
            }
        }
        function addHistory(p,w){
             const id=historyData.length+1; historyData.unshift({id,prize:p,winner:w});
             const div=document.createElement('div'); div.className='result-item';
             div.innerHTML=`<span>#${id} ${p}</span><strong>${w}</strong>`;
             resultList.querySelector('.result-header-group').insertAdjacentElement('afterend',div);
        }
        function copyToClipboard(){ /*...*/ }
        function exportToExcel(){ /*...*/ }

        // === [B] éŠæˆ²é‚è¼¯ (æ™ºæ…§åµæ¸¬ç‰ˆ) ===
        let gMin=1, gMax=100, secretCode=null, isGameOver=false;
        let sheetUrl="", syncTimer=null, lastRow=0;

        const rangeDisplay = document.getElementById('rangeDisplay');
        const gameMessage = document.getElementById('gameMessage');
        const gameInput = document.getElementById('gameInput');
        const winnerOverlay = document.getElementById('winnerOverlay');
        const boomNumber = document.getElementById('boomNumber');
        const syncDot = document.getElementById('syncDot');
        const syncText = document.getElementById('syncText');

        function resetGame() {
            gMin = parseInt(document.getElementById('minSet').value)||1;
            gMax = parseInt(document.getElementById('maxSet').value)||100;
            const sVal = document.getElementById('secretSet').value;
            
            if(sVal === "") {
                secretCode = Math.floor(Math.random()*(gMax-gMin+1))+gMin;
                logDebug("æœªè¨­å®šå¯†ç¢¼ï¼Œå·²éš¨æ©Ÿç”Ÿæˆ");
            } else {
                secretCode = parseInt(sVal);
                logDebug("å¯†ç¢¼å·²é–å®šç‚º: " + secretCode);
            }

            isGameOver = false;
            rangeDisplay.textContent = `${gMin} ~ ${gMax}`;
            gameMessage.textContent = "";
            winnerOverlay.style.display = 'none';
            gameInput.value = "";
            lastRow = 0;
        }

        function toggleGameMusic() { if(gameBg.paused) gameBg.play(); else gameBg.pause(); }

        function makeGuess() {
            if(isGameOver) return;
            const val = parseInt(gameInput.value);
            gameInput.value = "";
            processGuess(val);
        }

        // æ ¸å¿ƒåˆ¤æ–·
        function processGuess(val) {
            if(isNaN(val)) return;

            // â˜… å¼·åˆ¶æ¯”å° (è½‰æˆæ•¸å­—æ¯”å°ï¼Œå¿½ç•¥å‹åˆ¥)
            if(Number(val) === Number(secretCode)) {
                logDebug(`ğŸ¯ å‘½ä¸­å¯†ç¢¼ï¼è¼¸å…¥:${val}, ç­”æ¡ˆ:${secretCode}`);
                gameWin();
                return;
            }

            if(val <= gMin || val >= gMax) {
                gameMessage.textContent = `ç„¡æ•ˆï¼š${val}`;
                return;
            }

            if(val > secretCode) gMax = val;
            else gMin = val;
            
            rangeDisplay.textContent = `${gMin} ~ ${gMax}`;
            gameMessage.textContent = `æœ€æ–°æ•¸å­—ï¼š${val}`;
            beepSound.currentTime=0; beepSound.play();
            logDebug(`å€é–“æ›´æ–°: ${gMin} ~ ${gMax}`);
        }

        function gameWin() {
            isGameOver = true;
            rangeDisplay.textContent = secretCode;
            boomNumber.textContent = secretCode;
            winnerOverlay.style.display = 'flex';
            boomSound.currentTime=0; boomSound.play();
            syncText.textContent = "ğŸ‰ æ­å–œç­”å°ï¼éŠæˆ²çµæŸ";
        }
        function closeOverlay() { winnerOverlay.style.display='none'; }

        function updateSheetUrl() {
            sheetUrl = document.getElementById('sheetUrl').value.trim();
            if(sheetUrl.includes("http")) {
                syncText.textContent = "ğŸŸ¢ é›²ç«¯ç›£è½ä¸­...";
                syncDot.classList.add('active');
                if(!syncTimer) syncTimer = setInterval(checkSheet, 2000); // åŠ å¿«é »ç‡
            } else {
                syncText.textContent = "ğŸ”´ é›²ç«¯æœªé€£ç·š";
                syncDot.classList.remove('active');
                if(syncTimer) { clearInterval(syncTimer); syncTimer=null; }
            }
        }

        // â˜… æ™ºæ…§åµæ¸¬æ ¸å¿ƒ
        async function checkSheet() {
            if(isGameOver || !sheetUrl) return;
            try {
                const res = await fetch(sheetUrl + "&t=" + Date.now());
                const text = await res.text();
                // ç°¡æ˜“ CSV è§£æ
                const rows = text.split('\n').map(r => r.split(','));
                const total = rows.length;
                
                if(total <= 1) return;
                
                if(total > lastRow) {
                    if(lastRow === 0) { lastRow = total; return; } // åˆæ¬¡è¼‰å…¥å¿½ç•¥èˆŠè³‡æ–™

                    // å–å¾—æœ€æ–°ä¸€è¡Œ
                    const latestRow = rows[total-1];
                    logDebug(`æ”¶åˆ°æ–°è³‡æ–™ (è¡Œæ•¸:${total}): ${latestRow.join('|')}`);

                    // â˜… æ™ºæ…§æƒæï¼šæƒææ•´è¡Œï¼Œæ‰¾å‡ºçœ‹èµ·ä¾†åƒç­”æ¡ˆçš„æ•¸å­—
                    let foundNumber = null;
                    
                    // å¾å¾Œå¾€å‰æ‰¾ (é€šå¸¸æœ€æ–°çš„æ¬„ä½åœ¨å¾Œé¢)
                    for(let i = latestRow.length - 1; i >= 0; i--) {
                        // æ¸…ç†è³‡æ–™ï¼šå»æ‰å¼•è™Ÿã€ç©ºç™½
                        let raw = latestRow[i].replace(/['"\s]+/g, ''); 
                        let val = parseInt(raw);
                        
                        // æ¢ä»¶ï¼šå¿…é ˆæ˜¯æ•¸å­—ï¼Œä¸”åœ¨åˆç†ç¯„åœå…§ (1~999) é¿å…æŠ“åˆ° Timestamp
                        if(!isNaN(val) && val < 1000 && val > 0) {
                            foundNumber = val;
                            break; // æ‰¾åˆ°å°±åœæ­¢
                        }
                    }

                    if(foundNumber !== null) {
                        syncDot.style.background = "#FF5722";
                        setTimeout(()=> syncDot.style.background = "#00E676", 500);
                        logDebug(`è§£æå‡ºæ•¸å­—: ${foundNumber}`);
                        processGuess(foundNumber);
                    } else {
                        logDebug("âš ï¸ è©²è¡Œæœªç™¼ç¾æœ‰æ•ˆæ•¸å­—");
                    }
                    
                    lastRow = total;
                }
            } catch(e) { console.log(e); }
        }
    </script>
</body>
</html>